<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Nitrate Dots on Water</title>
<style>
.problem-band {
    position: relative;
    padding: 4rem 1.5rem;
    text-align: center;
    border-bottom: 1px solid #e2e8f0;
    overflow: hidden;
}

.problem-inner {
    max-width: 800px;
    margin: 0 auto;
    position: relative;
    z-index: 10;
}

.problem-inner h2 { font-size: 2.25rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem; }
.problem-inner p { font-size: 1.125rem; line-height: 1.8; color: #475569; }

.water-animation-svg {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 60%;
    z-index: 1;
    overflow: visible;
}

.waves-svg {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 150px; /* match SVG viewBox height */
}

.nitrate-container {
    position: absolute;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 5;
}
</style>
</head>
<body>

<section class="problem-band" aria-labelledby="problem-heading">
    <div class="problem-inner">
      <h2 id="problem-heading">A Hidden Threat in Our Soil: Nitrate Leaching</h2>
      <p>
        Nitrogen fertilizers are essential for modern agriculture, but up to 50% is lost as nitrate, washing away from roots and into our water supplies. This contamination threatens ecosystems and human health while wasting a vital resource for farmers.
      </p>
    </div>

    <div class="water-animation">
        <div id="nitrate-container" class="nitrate-container"></div>

        <svg class="waves" id="wave-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 150">
            <path id="wave-path" fill="rgba(147, 212, 249, 0.5)" d="M0,64 C240,110 480,10 720,64 S960,110 1200,64 S1440,10 1440,64 V150 H0 Z"></path>
        </svg>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById('nitrate-container');
    const path = document.getElementById('wave-path');
    const pathLength = path.getTotalLength();

    const dotCount = 6;

    function createDot() {
        const dot = document.createElement('div');
        dot.className = 'floating-dot';
        container.appendChild(dot);

        // Clear any green background
        dot.style.background = 'transparent';
        dot.style.width = '30px';
        dot.style.height = '30px';

        // Create the nitrate SVG inside the div
        dot.innerHTML = `
        <svg width="30" height="30" viewBox="0 0 30 30">
            <!-- Nitrogen incenter -->
            <circle cx="15" cy="15" r="5" fill="blue"/>
            <!-- Oxygen atoms at triangle vertices -->
            <circle cx="15" cy="3" r="5" fill="red"/>
            <circle cx="3" cy="25" r="5" fill="red"/>
            <circle cx="27" cy="25" r="5" fill="red"/>
        </svg>`;


        const heightVariation = Math.random() * 10 - 5;
        const duration = 7500 + Math.random() * 500; // 7–8 seconds
        let startTime = performance.now();

        const startPoint = path.getPointAtLength(0);
        let prevX = startPoint.x;

        function animate(now) {
            const elapsed = now - startTime;
            let progress = elapsed / duration;

            if (progress >= 1) {
                dot.style.opacity = 0; // hide while waiting
                setTimeout(() => {
                    startTime = performance.now();
                    prevX = 0;
                    requestAnimationFrame(animate);
                }, 2000 + Math.random() * 1000); // 2–3s wait
                return;
            }

            const distance = pathLength * progress;
            const point = path.getPointAtLength(distance);
            const waveOffset = 20;
            dot.style.transform = `translate(${point.x - 15}px, ${point.y + waveOffset + heightVariation}px)`;

            // Compute velocity
            const velocityX = point.x - prevX;
            prevX = point.x;

            // Visibility logic based on direction and position
            const leftThreshold = 30;  // start showing after x > 30
            const rightThreshold = container.offsetWidth - 50; // hide when x > width-30
            if (velocityX > 0 && point.x > leftThreshold && point.x < rightThreshold) {
                dot.style.opacity = 1;
            } else {
                dot.style.opacity = 0;
            }

            requestAnimationFrame(animate);
        }

        requestAnimationFrame(animate);
    }

    for (let i = 0; i < dotCount; i++) {
        setTimeout(createDot, i * 500);
    }
});
</script>

</body>
</html>
